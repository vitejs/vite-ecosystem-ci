From 0e1ac6a3a01e937a0b317d7cf7beb9d06724a741 Mon Sep 17 00:00:00 2001
From: sapphi-red <49056869+sapphi-red@users.noreply.github.com>
Date: Fri, 17 Jan 2025 18:25:09 +0900
Subject: [PATCH] temporary commit

---
 src/index.ts | 19 ++++++++++++-------
 1 file changed, 12 insertions(+), 7 deletions(-)

diff --git a/src/index.ts b/src/index.ts
index 64acab1..72c37c4 100644
--- a/src/index.ts
+++ b/src/index.ts
@@ -488,7 +488,7 @@ export default function markoPlugin(opts: Options = {}): vite.Plugin[] {
         }
       },
 
-      async buildStart(inputOptions) {
+      async options(inputOptions) {
         if (isBuild && linked && !isSSRBuild) {
           try {
             serverManifest = await store.read();
@@ -498,12 +498,6 @@ export default function markoPlugin(opts: Options = {}): vite.Plugin[] {
               entryIds.add(id);
               cachedSources.set(id, serverManifest.entrySources[entry]);
             }
-            for (const assetId of serverManifest.ssrAssetIds) {
-              this.load({
-                id: normalizePath(path.resolve(root, assetId)),
-                resolveDependencies: false,
-              }).catch(noop);
-            }
           } catch (err) {
             this.error(
               `You must run the "ssr" build before the "browser" build.`,
@@ -515,6 +509,17 @@ export default function markoPlugin(opts: Options = {}): vite.Plugin[] {
           }
         }
       },
+
+      async buildStart() {
+        if (isBuild && linked && !isSSRBuild) {
+          for (const assetId of serverManifest!.ssrAssetIds) {
+            this.load({
+              id: normalizePath(path.resolve(root, assetId)),
+              resolveDependencies: false,
+            }).catch(noop);
+          }
+        }
+      },
       async resolveId(importee, importer, importOpts, ssr = importOpts.ssr) {
         if (virtualFiles.has(importee)) {
           return importee;
-- 
2.47.1

