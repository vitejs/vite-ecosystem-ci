From f18187703077e5311a864f2fcf59ca12da1fc840 Mon Sep 17 00:00:00 2001
From: sapphi-red <49056869+sapphi-red@users.noreply.github.com>
Date: Wed, 26 Mar 2025 22:32:29 +0900
Subject: [PATCH] temporary commit

---
 packages/e2e-tests/scan-deps/__tests__/scan-deps.spec.ts | 2 +-
 packages/vite-plugin-svelte/src/index.js                 | 2 ++
 packages/vite-plugin-svelte/src/preprocess.js            | 2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/packages/e2e-tests/scan-deps/__tests__/scan-deps.spec.ts b/packages/e2e-tests/scan-deps/__tests__/scan-deps.spec.ts
index 0bdde48..1d6eb5a 100644
--- a/packages/e2e-tests/scan-deps/__tests__/scan-deps.spec.ts
+++ b/packages/e2e-tests/scan-deps/__tests__/scan-deps.spec.ts
@@ -4,7 +4,7 @@ describe('vite import scan', () => {
 	it('should not fail to discover dependencies exported from script module', async () => {
 		// vite logs an error if scan fails but continues, so validate no errors logged
 		expect(
-			e2eServer.logs.server.err.length,
+			e2eServer.logs.server.err.filter((e) => !e.includes('optimizeDeps.esbuildOptions')).length,
 			`unexpected errors:\n${e2eServer.logs.server.err.join('\n')}`
 		).toBe(0);
 	});
diff --git a/packages/vite-plugin-svelte/src/index.js b/packages/vite-plugin-svelte/src/index.js
index 9ec43e9..dc962b5 100644
--- a/packages/vite-plugin-svelte/src/index.js
+++ b/packages/vite-plugin-svelte/src/index.js
@@ -153,6 +153,7 @@ export function svelte(inlineOptions) {
 				}
 			},
 
+			// @ts-expect-error rolldown type incompatibility
 			async transform(code, id, opts) {
 				const ssr = !!opts?.ssr;
 				const svelteRequest = requestParser(id, ssr);
@@ -173,6 +174,7 @@ export function svelte(inlineOptions) {
 						for (const dep of compileData.dependencies) {
 							ensureWatchedFile(options.server.watcher, dep, options.root);
 						}
+						// @ts-expect-error rolldown-vite does not support watch mode yet
 					} else if (options.isBuild && viteConfig.build.watch) {
 						for (const dep of compileData.dependencies) {
 							this.addWatchFile(dep);
diff --git a/packages/vite-plugin-svelte/src/preprocess.js b/packages/vite-plugin-svelte/src/preprocess.js
index d63ea23..d6adcc1 100644
--- a/packages/vite-plugin-svelte/src/preprocess.js
+++ b/packages/vite-plugin-svelte/src/preprocess.js
@@ -36,7 +36,7 @@ function viteScript() {
 			const lang = /** @type {string} */ (attributes.lang);
 			if (!supportedScriptLangs.includes(lang)) return;
 			const { code, map } = await transformWithEsbuild(content, filename, {
-				loader: /** @type {import('vite').ESBuildOptions['loader']} */ (lang),
+				loader: /** @type {import('vite').EsbuildTransformOptions['loader']} */ (lang),
 				target: 'esnext',
 				tsconfigRaw: {
 					compilerOptions: {
-- 
2.48.1

