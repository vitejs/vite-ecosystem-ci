From 8ee779b5368682cc887fb35b33d6e78a0d98c044 Mon Sep 17 00:00:00 2001
From: sapphi-red <49056869+sapphi-red@users.noreply.github.com>
Date: Wed, 26 Mar 2025 13:14:39 +0900
Subject: [PATCH] temporary commit

---
 packages/histoire-plugin-nuxt/src/index.ts |  1 +
 packages/histoire/src/node/build.ts        | 34 +++++++++++-----------
 packages/histoire/src/node/vite.ts         |  1 +
 3 files changed, 19 insertions(+), 17 deletions(-)

diff --git a/packages/histoire-plugin-nuxt/src/index.ts b/packages/histoire-plugin-nuxt/src/index.ts
index d705348..a137085 100644
--- a/packages/histoire-plugin-nuxt/src/index.ts
+++ b/packages/histoire-plugin-nuxt/src/index.ts
@@ -19,6 +19,7 @@ export function HstNuxt(): Plugin {
   return {
     name: '@histoire/plugin-nuxt',
 
+    // @ts-expect-error rolldown type incompatibility
     async defaultConfig() {
       const nuxtViteConfig = await useNuxtViteConfig()
       const { viteConfig } = nuxtViteConfig
diff --git a/packages/histoire/src/node/build.ts b/packages/histoire/src/node/build.ts
index 8419188..d2455bb 100644
--- a/packages/histoire/src/node/build.ts
+++ b/packages/histoire/src/node/build.ts
@@ -146,23 +146,23 @@ export async function build(ctx: Context) {
       config.build.rollupOptions.external = []
 
       // Force chunk strategy
-      config.build.rollupOptions.output = {
-        manualChunks(id) {
-          if (!id.includes('@histoire/app') && id.includes('node_modules')) {
-            for (const test of ctx.config.build?.excludeFromVendorsChunk ?? []) {
-              if ((
-                typeof test === 'string' && id.includes(test)
-              ) || (
-                test instanceof RegExp && test.test(id)
-              )) {
-                // Excluded from vendor chunk
-                return
-              }
-            }
-            return 'vendor'
-          }
-        },
-      }
+      // config.build.rollupOptions.output = {
+      //   manualChunks(id) {
+      //     if (!id.includes('@histoire/app') && id.includes('node_modules')) {
+      //       for (const test of ctx.config.build?.excludeFromVendorsChunk ?? []) {
+      //         if ((
+      //           typeof test === 'string' && id.includes(test)
+      //         ) || (
+      //           test instanceof RegExp && test.test(id)
+      //         )) {
+      //           // Excluded from vendor chunk
+      //           return
+      //         }
+      //       }
+      //       return 'vendor'
+      //     }
+      //   },
+      // }
 
       // Force vite build options
       Object.assign(config.build, {
diff --git a/packages/histoire/src/node/vite.ts b/packages/histoire/src/node/vite.ts
index 5749684..3c24d61 100644
--- a/packages/histoire/src/node/vite.ts
+++ b/packages/histoire/src/node/vite.ts
@@ -154,6 +154,7 @@ export async function getViteConfigWithPlugins(isServer: boolean, ctx: Context):
     },
 
     options() {
+      // @ts-expect-error should add property to rolldown's types instead of rollup's types
       this.meta.histoire = {
         isCollecting: isServer,
       }
-- 
2.48.1

