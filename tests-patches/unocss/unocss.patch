From cf77e3627e4baf302fca814d1e3eaebf1505748a Mon Sep 17 00:00:00 2001
From: sapphi-red <49056869+sapphi-red@users.noreply.github.com>
Date: Tue, 22 Apr 2025 15:43:19 +0900
Subject: [PATCH] temporary commit

---
 packages-integrations/astro/src/index.ts            | 1 +
 packages-integrations/vite/src/modes/chunk-build.ts | 4 ++--
 test/fixtures.test.ts                               | 6 ++++--
 3 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/packages-integrations/astro/src/index.ts b/packages-integrations/astro/src/index.ts
index 126cf30..85e4a4e 100644
--- a/packages-integrations/astro/src/index.ts
+++ b/packages-integrations/astro/src/index.ts
@@ -101,6 +101,7 @@ export default function UnoCSSAstroIntegration<Theme extends object>(
           vite: {
             plugins: [AstroVitePlugin({
               injects,
+              // @ts-expect-error rolldown type incompat
             }), ...VitePlugin(options, defaults)],
           },
         })
diff --git a/packages-integrations/vite/src/modes/chunk-build.ts b/packages-integrations/vite/src/modes/chunk-build.ts
index 657b409..6e326b6 100644
--- a/packages-integrations/vite/src/modes/chunk-build.ts
+++ b/packages-integrations/vite/src/modes/chunk-build.ts
@@ -42,8 +42,8 @@ export function ChunkModeBuildPlugin(ctx: UnocssPluginContext): Plugin {
       await cssPostTransformHandler.call(this as Rollup.TransformPluginContext, css, fakeCssId)
       chunk.modules[fakeCssId] = {
         code: null,
-        originalLength: 0,
-        removedExports: [],
+        // originalLength: 0,
+        // removedExports: [],
         renderedExports: [],
         renderedLength: 0,
       }
diff --git a/test/fixtures.test.ts b/test/fixtures.test.ts
index c353031..ca318b8 100644
--- a/test/fixtures.test.ts
+++ b/test/fixtures.test.ts
@@ -52,7 +52,8 @@ describe.concurrent('fixtures', () => {
     expect(css).not.contains('.text-teal')
   })
 
-  it.skipIf(isWindows)('vite legacy', async () => {
+  // NOTE: rolldown does not support legacy plugin
+  it.skipIf(isWindows || true)('vite legacy', async () => {
     const root = resolve(__dirname, 'fixtures/vite-legacy')
     await fs.emptyDir(join(root, 'dist'))
     await build({
@@ -71,7 +72,8 @@ describe.concurrent('fixtures', () => {
     expect(css).contains('.text-red')
   }, 15000)
 
-  it.skipIf(isWindows)('vite legacy renderModernChunks false', async () => {
+  // NOTE: rolldown does not support legacy plugin
+  it.skipIf(isWindows || true)('vite legacy renderModernChunks false', async () => {
     const root = resolve(__dirname, 'fixtures/vite-legacy-chunks')
     await fs.emptyDir(join(root, 'dist'))
     await build({
-- 
2.48.1

